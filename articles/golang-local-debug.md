# Локальная отладка облачных функций
Не так давно мы начали использовать облачные функции. В основном это внутренние проекты, для обработки вебхуков от CRM, мессенджеров и прочих систем. Несмотря на то, что основным языком для разработки приложений у нас является C#, для функций мы начали использовать Golang. Для этого было несколько причин. Первый раз мы работали с Yandex.Cloud, и на тот момент у него не было поддержки C# для облачных функций. А из всех доступных языков у Golang было наименьшее время холодного старта. На данный момент мы переехали на AWS, но продолжаем писать на go.

В данной статье я хочу рассказать о методах локальной отладки функций, которые мы используем. 

В качестве примера рассмотрим функцию, котораю обрабатывает вебхук от телеграма, записывает идентификатор чата в базу данных и отвечает пользователю.

<details>
    <summary>main.go</summary>
</details>


<details>
    <summary>handler.go</summary>
</details>

Первый вариант для отладки был таким. 
При старте проекта мы проверяем наличие заранее определенного флага в переменных окружения, и в случае его наличия запускаем вебсервер с одним роутом. Далее через тесты или через postman мы шлем запросы и отлаживаем наш код.

<details>
    <summary>обновленный main.go</summary>
<details>

На этом можно было и закончить, но подход не лишен недостатков.
Необходимо данный код переносить из проекта проект, к тому же при билде он попадает в продакшен. 

Как можно этого избежать? Самое время вспомнить о юнит-тестах.
Так или иначе, мы их пишем на сложные части бизнес логики.

Для этого подхода нам необходимо замокать внешние зависимости.

<details>
    <summary>handler_test.go<summary>
</details>

Казалось бы вот этот момент, когда совершенство найдено.
Но одна вещь не давала покоя. Моки это не реальные объекты. Через них можно сымитировать любое поведение если знать, что имитировать. Например задержки ответов от внешних сервисов.

Второй момент это окружение разработки. Как .net-разработчики мы используем windows. Функции работают на linux. Проблем с функциями из-за этого у нас не было, но в прошлом мы сталкивались c проблемой, когда наше чудесное приложение на кроссплатформенном .net core в docker-контейнере пыталось неуспешно вызвать winapi (через один из nuget-пакетов).

Что собственно предлагает AWS? 




Второй вариант 

Отладка через юнит тесты



Третий вариант

Создание проекта

Минимальная конфигурация

Код приложения

Отладчик Delve

Подключаем dynamodb

Итоги